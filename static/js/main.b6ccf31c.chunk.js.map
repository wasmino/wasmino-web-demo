{"version":3,"sources":["../../../src/index.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["_a","sent","i","params","URLSearchParams","window","location","hash","replace","defaultWasmSrc","get","defaultPins","JSON","parse","e","console","warn","PinType","wasmino","Wasmino","wasiBindings","LedComponent","props","className","style","backgroundColor","color","value","text","onClick","onClose","SwitchComponent","type","onChange","undefined","currentTarget","checked","Component","LED","SWITCH","App","React","useState","wasmSrc","setWasmSrc","pinId","setPinId","pins","setPins","outputs","setOutputs","running","setRunning","set","stringify","toString","run","a","wasmUrl","startsWith","fetch","slice","response","json","responseJson","Object","values","files","alert","error","useEffect","intervalHandle","setInterval","initialized","newOutputs","key","output","readPin","Number","clearInterval","placeholder","stop","valueAsNumber","isNaN","keys","map","k","pinsCopy","v","writePin","pinProps","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b6ccf31c.chunk.js","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_fetch_1 = require(\"cross-fetch\");\nvar abab_1 = require(\"abab\");\nvar wasi_1 = require(\"@wasmer/wasi\");\nfunction sleep(ms) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, new Promise(function (resolve) {\n                        setTimeout(resolve, ms);\n                    })];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n;\nvar Wasmino = /** @class */ (function () {\n    function Wasmino(wasm, wasiBindings) {\n        this.wasiBindings = wasiBindings;\n        this.running = false;\n        this.initialized = false;\n        this.intervalHandle = 0;\n        // timestamp in nanoseconds\n        this.hostClock = BigInt(0);\n        this.clientClock = BigInt(0);\n        this.clientSleeping = false;\n        if (typeof (wasm) === \"string\") {\n            this.wasmURL = wasm;\n        }\n        else {\n            this.wasmArrayBuffer = wasm;\n        }\n    }\n    Wasmino.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var responseArrayBuffer, response, responseUint8Array, wasmArrayBuffer, decoder, b64String, bytesString, bytes, i, wasi, module, instance;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        responseArrayBuffer = this.wasmArrayBuffer;\n                        if (!(responseArrayBuffer === undefined)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cross_fetch_1.default(this.wasmURL)];\n                    case 1:\n                        response = _a.sent();\n                        return [4 /*yield*/, response.arrayBuffer()];\n                    case 2:\n                        responseArrayBuffer = _a.sent();\n                        _a.label = 3;\n                    case 3:\n                        responseUint8Array = new Uint8Array(responseArrayBuffer);\n                        wasmArrayBuffer = responseArrayBuffer;\n                        if (String.fromCharCode(responseUint8Array[0]) === \"A\") {\n                            decoder = new TextDecoder();\n                            b64String = decoder.decode(responseArrayBuffer);\n                            bytesString = abab_1.atob(b64String);\n                            bytes = new Array(bytesString.length);\n                            for (i = 0; i < bytesString.length; i++) {\n                                bytes[i] = bytesString.charCodeAt(i);\n                            }\n                            wasmArrayBuffer = new Uint8Array(bytes).buffer;\n                        }\n                        wasi = new wasi_1.WASI({\n                            args: [],\n                            env: {},\n                            bindings: this.wasiBindings,\n                        });\n                        return [4 /*yield*/, WebAssembly.compile(wasmArrayBuffer)];\n                    case 4:\n                        module = _a.sent();\n                        return [4 /*yield*/, WebAssembly.instantiate(module, __assign(__assign({}, wasi.getImports(module)), { wasmino: {\n                                    nanosleep: function (s, ns) {\n                                        var exports = _this.getExports();\n                                        if (exports === undefined) {\n                                            throw new Error(\"sleep called before initialization\");\n                                        }\n                                        if (!_this.clientSleeping) {\n                                            if (_this.asyncifyPtr === undefined) {\n                                                // initialize asyncify pointer\n                                                var asyncifyBufferSize = 4096;\n                                                _this.asyncifyPtr = exports.malloc(asyncifyBufferSize);\n                                                var uint32Mem = new Uint32Array(exports.memory.buffer);\n                                                uint32Mem[_this.asyncifyPtr >> 2] = _this.asyncifyPtr + 8;\n                                                uint32Mem[(_this.asyncifyPtr >> 2) + 1] = _this.asyncifyPtr + asyncifyBufferSize;\n                                            }\n                                            exports.asyncify_start_unwind(_this.asyncifyPtr);\n                                            _this.clientSleeping = true;\n                                            _this.clientClock = _this.clientClock + BigInt(1e9) * BigInt(s) + BigInt(ns);\n                                        }\n                                        else {\n                                            exports.asyncify_stop_rewind();\n                                            _this.clientSleeping = false;\n                                        }\n                                    }\n                                } }))];\n                    case 5:\n                        instance = _a.sent();\n                        this.instance = instance;\n                        wasi.start(instance);\n                        this.initialized = true;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Wasmino.prototype.run = function (ms) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.running) {\n                            return [2 /*return*/];\n                        }\n                        if (!!this.initialized) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.init()];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        this.intervalHandle = setInterval(function () {\n                            _this.tick(ms);\n                        }, ms);\n                        this.running = true;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Wasmino.prototype.stop = function () {\n        if (!this.running) {\n            return;\n        }\n        clearInterval(this.intervalHandle);\n        this.running = false;\n    };\n    Wasmino.prototype.tick = function (ms) {\n        this.hostClock = this.hostClock + BigInt(ms * 1e6);\n        this._tick();\n    };\n    Wasmino.prototype.nanoTick = function (s, ns) {\n        this.hostClock = this.hostClock + BigInt(1e9) * BigInt(s) + BigInt(ns);\n        this._tick();\n    };\n    Wasmino.prototype.readPin = function (pin) {\n        var exports = this.getExports();\n        if (exports === undefined) {\n            return 0;\n        }\n        return exports.wasminoReadPin(pin);\n    };\n    Wasmino.prototype.writePin = function (pin, value) {\n        var exports = this.getExports();\n        if (exports === undefined) {\n            throw new Error(\"Not initialized\");\n        }\n        // since a interrupt may trigger, which may read uptime, rollback time to host time, and revert after.\n        exports.wasminoSetUptime(Number(this.hostClock / BigInt(1e9)), Number(this.hostClock % BigInt(1e9)));\n        exports.wasminoWritePin(pin, value);\n        exports.wasminoSetUptime(Number(this.clientClock / BigInt(1e9)), Number(this.clientClock % BigInt(1e9)));\n        return;\n    };\n    Wasmino.prototype.getPinCount = function () {\n        var exports = this.getExports();\n        if (exports === undefined) {\n            throw new Error(\"Not initialized\");\n        }\n        return exports.wasminoGetPinCount();\n    };\n    Wasmino.prototype.getPinMode = function (pin) {\n        var exports = this.getExports();\n        if (exports === undefined) {\n            throw new Error(\"Not initialized\");\n        }\n        return exports.wasminoGetPinMode(pin);\n    };\n    Wasmino.prototype.getExports = function () {\n        if (this.instance === undefined) {\n            return undefined;\n        }\n        return this.instance.exports;\n    };\n    Wasmino.prototype._tick = function () {\n        var exports = this.getExports();\n        if (exports === undefined) {\n            throw new Error(\"Cannot tick before initialization\");\n        }\n        while (this.clientClock < this.hostClock) {\n            // when hostClock is ahead of clientClock, repeat execution.\n            exports.asyncify_start_rewind(this.asyncifyPtr);\n            exports._start();\n            exports.asyncify_stop_unwind();\n        }\n    };\n    return Wasmino;\n}());\nexports.default = Wasmino;\n//# sourceMappingURL=index.js.map","import React, { useEffect } from \"react\";\nimport \"./App.css\";\n\nimport Wasmino from \"@wasmino/runtime\";\nimport wasiBindings from \"@wasmer/wasi/lib/bindings/browser\";\n\nconst TICK_MS = 50;\n\nconst params = new URLSearchParams(window.location.hash.replace(/^#/, \"\"));\nconst defaultWasmSrc = params.get(\"src\") ?? \"\";\nlet defaultPins = {};\ntry {\n\tdefaultPins = JSON.parse(params.get(\"pins\") ?? \"{}\");\n} catch (e) {\n\tconsole.warn(\"Cannot parse pins config, defaulting to empty\");\n}\n\nlet wasmino = new Wasmino(\"\", wasiBindings);\n\nenum PinType {\n\tLED = \"led\",\n\tSWITCH = \"switch\",\n}\n\ninterface PinCommonProps {\n\ttext?: string;\n\tonClose?: () => void;\n}\n\ninterface InputPin extends PinCommonProps {\n\tonChange?: (value: boolean) => void;\n}\n\ninterface OutputPin extends PinCommonProps {\n\tvalue: number;\n}\n\ninterface LedPinProps extends OutputPin {\n\ttype: PinType.LED;\n\tcolor: string;\n}\n\ninterface SwitchPinProps extends InputPin {\n\ttype: PinType.SWITCH;\n}\n\ntype PinProps = LedPinProps | SwitchPinProps;\n\nconst LedComponent = (props: LedPinProps) => {\n\t// console.log(props.value);\n\treturn (\n\t\t<div className=\"component\">\n\t\t\t<div\n\t\t\t\tclassName=\"led\"\n\t\t\t\tstyle={{ backgroundColor: `rgba(${props.color}, ${props.value})` }}\n\t\t\t></div>\n\t\t\t<div className=\"pin-name\">{props.text}</div>\n\t\t\t<div className=\"close\" onClick={props.onClose}>\n\t\t\t\tx\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst SwitchComponent = (props: SwitchPinProps) => {\n\treturn (\n\t\t<div className=\"component\">\n\t\t\t<label className=\"switch\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tif (props.onChange === undefined) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprops.onChange(e.currentTarget.checked);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<span className=\"slider round\"></span>\n\t\t\t</label>\n\t\t\t<div className=\"pin-name\">{props.text}</div>\n\t\t\t<div className=\"close\" onClick={props.onClose}>\n\t\t\t\tx\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nconst Component = (props: PinProps) => {\n\tswitch (props.type) {\n\t\tcase PinType.LED:\n\t\t\treturn <LedComponent {...props} />;\n\t\tcase PinType.SWITCH:\n\t\t\treturn <SwitchComponent {...props} />;\n\t\tdefault:\n\t\t\treturn <div />;\n\t}\n};\n\ninterface Pins {\n\t[pinId: string]:\n\t\t| {\n\t\t\t\ttype: PinType;\n\t\t  }\n\t\t| PinProps;\n}\n\ninterface Outputs {\n\t[pinId: string]: number;\n}\n\nfunction App() {\n\tconst [wasmSrc, setWasmSrc] = React.useState<string>(defaultWasmSrc);\n\tconst [pinId, setPinId] = React.useState<number>();\n\tconst [pins, setPins] = React.useState<Pins>(defaultPins);\n\tconst [outputs, setOutputs] = React.useState<Outputs>({});\n\tconst [running, setRunning] = React.useState<boolean>(wasmino.running);\n\n\tconst params = new URLSearchParams();\n\tparams.set(\"src\", wasmSrc);\n\tparams.set(\"pins\", JSON.stringify(pins));\n\twindow.location.hash = \"#\" + params.toString();\n\n\tconst pinProps = (i: string): PinProps => {\n\t\tconst type = pins[i].type;\n\t\tconst value = outputs[i];\n\t\tconst text = `PIN ${i}`;\n\t\tconst onClose = () => {\n\t\t\tconst pinsCopy = pins;\n\t\t\tdelete pinsCopy[i];\n\t\t\tsetPins(pinsCopy);\n\t\t};\n\t\tswitch (type) {\n\t\t\tcase PinType.LED:\n\t\t\t\treturn { color: \"0, 255, 0\", ...pins[i], type, text, onClose, value };\n\t\t\tcase PinType.SWITCH:\n\t\t\t\treturn {\n\t\t\t\t\t...pins[i],\n\t\t\t\t\ttype,\n\t\t\t\t\ttext,\n\t\t\t\t\tonClose,\n\t\t\t\t\tonChange: (v) => {\n\t\t\t\t\t\tif (!wasmino.initialized) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twasmino.writePin(Number(i), v ? 1 : 0);\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t}\n\t};\n\n\tconst run = async () => {\n\t\tif (wasmino.running) {\n\t\t\treturn;\n\t\t}\n\t\tlet wasmUrl = wasmSrc;\n\t\ttry {\n\t\t\tif (wasmSrc.startsWith(\"gist://\")) {\n\t\t\t\tconst response = await fetch(\n\t\t\t\t\t\"https://api.github.com/gists/\" + wasmSrc.slice(7)\n\t\t\t\t);\n\t\t\t\tconst responseJson = await response.json();\n\t\t\t\twasmUrl = (Object.values(responseJson.files)[0] as any)[\"raw_url\"];\n\t\t\t}\n\t\t} catch (e) {\n\t\t\talert(\"Cannot fetch Gist, check Gist ID?\");\n\t\t}\n\t\ttry {\n\t\t\twasmino = new Wasmino(wasmUrl, wasiBindings);\n\t\t\tsetRunning(true);\n\t\t\twasmino.run(TICK_MS);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\talert(\"Cannot initialize Wasmino, check console logs for detail\");\n\t\t}\n\t};\n\n\tconst stop = () => {\n\t\tsetRunning(false);\n\t\twasmino.stop();\n\t};\n\n\tuseEffect(() => {\n\t\t// read from outputs\n\t\tconst intervalHandle = setInterval(() => {\n\t\t\tif (!wasmino.initialized) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst newOutputs: Outputs = {};\n\t\t\tfor (const key in pins) {\n\t\t\t\tconst output = wasmino.readPin(Number(key));\n\t\t\t\tnewOutputs[key] = output;\n\t\t\t}\n\t\t\tsetOutputs(newOutputs);\n\t\t}, TICK_MS);\n\t\treturn () => {\n\t\t\tclearInterval(intervalHandle);\n\t\t};\n\t});\n\treturn (\n\t\t<div className=\"app\">\n\t\t\t<div className=\"controls\">\n\t\t\t\t<input\n\t\t\t\t\tplaceholder=\"WASM URL\"\n\t\t\t\t\tvalue={wasmSrc}\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tsetWasmSrc(e.currentTarget.value);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<button onClick={running ? stop : run}>\n\t\t\t\t\t{running ? \"Stop\" : \"Run\"}\n\t\t\t\t</button>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"number\"\n\t\t\t\t\tplaceholder=\"PIN number\"\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tsetPinId(e.currentTarget.valueAsNumber >> 0);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tif (pinId === undefined || isNaN(pinId)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetPins({ ...pins, [pinId]: { type: PinType.LED } });\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tAdd LED\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tif (pinId === undefined || isNaN(pinId)) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetPins({ ...pins, [pinId]: { type: PinType.SWITCH } });\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tAdd Switch\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div className=\"switchboard\">\n\t\t\t\t{Object.keys(pins).map((k) => (\n\t\t\t\t\t<Component key={k} {...pinProps(k)} />\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n\tif (onPerfEntry && onPerfEntry instanceof Function) {\n\t\timport(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n\t\t\tgetCLS(onPerfEntry);\n\t\t\tgetFID(onPerfEntry);\n\t\t\tgetFCP(onPerfEntry);\n\t\t\tgetLCP(onPerfEntry);\n\t\t\tgetTTFB(onPerfEntry);\n\t\t});\n\t}\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}