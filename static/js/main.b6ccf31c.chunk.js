(this["webpackJsonp@wasmino/demo"]=this["webpackJsonp@wasmino/demo"]||[]).push([[0],{12:function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function c(t){try{s(i.next(t))}catch(e){a(e)}}function o(t){try{s(i.throw(t))}catch(e){a(e)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,o)}s((i=i.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,i,r,a,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,i=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){c=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){c.label=a[1];break}if(6===a[0]&&c.label<r[1]){c.label=r[1],r=a;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(a);break}r[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(o){a=[6,o],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(e,"__esModule",{value:!0});var c=n(30),o=n(31),s=n(34);var l=function(){function t(t,e){this.wasiBindings=e,this.running=!1,this.initialized=!1,this.intervalHandle=0,this.hostClock=BigInt(0),this.clientClock=BigInt(0),this.clientSleeping=!1,"string"===typeof t?this.wasmURL=t:this.wasmArrayBuffer=t}return t.prototype.init=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,l,u,h,f,p,d,b,v=this;return a(this,(function(a){switch(a.label){case 0:return void 0!==(t=this.wasmArrayBuffer)?[3,3]:[4,c.default(this.wasmURL)];case 1:return[4,a.sent().arrayBuffer()];case 2:t=a.sent(),a.label=3;case 3:if(e=new Uint8Array(t),n=t,"A"===String.fromCharCode(e[0])){for(r=new TextDecoder,l=r.decode(t),u=o.atob(l),h=new Array(u.length),f=0;f<u.length;f++)h[f]=u.charCodeAt(f);n=new Uint8Array(h).buffer}return p=new s.WASI({args:[],env:{},bindings:this.wasiBindings}),[4,WebAssembly.compile(n)];case 4:return d=a.sent(),[4,WebAssembly.instantiate(d,i(i({},p.getImports(d)),{wasmino:{nanosleep:function(t,e){var n=v.getExports();if(void 0===n)throw new Error("sleep called before initialization");if(v.clientSleeping)n.asyncify_stop_rewind(),v.clientSleeping=!1;else{if(void 0===v.asyncifyPtr){v.asyncifyPtr=n.malloc(4096);var i=new Uint32Array(n.memory.buffer);i[v.asyncifyPtr>>2]=v.asyncifyPtr+8,i[1+(v.asyncifyPtr>>2)]=v.asyncifyPtr+4096}n.asyncify_start_unwind(v.asyncifyPtr),v.clientSleeping=!0,v.clientClock=v.clientClock+BigInt(1e9)*BigInt(t)+BigInt(e)}}}}))];case 5:return b=a.sent(),this.instance=b,p.start(b),this.initialized=!0,[2]}}))}))},t.prototype.run=function(t){return r(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){switch(n.label){case 0:return this.running?[2]:this.initialized?[3,2]:[4,this.init()];case 1:n.sent(),n.label=2;case 2:return this.intervalHandle=setInterval((function(){e.tick(t)}),t),this.running=!0,[2]}}))}))},t.prototype.stop=function(){this.running&&(clearInterval(this.intervalHandle),this.running=!1)},t.prototype.tick=function(t){this.hostClock=this.hostClock+BigInt(1e6*t),this._tick()},t.prototype.nanoTick=function(t,e){this.hostClock=this.hostClock+BigInt(1e9)*BigInt(t)+BigInt(e),this._tick()},t.prototype.readPin=function(t){var e=this.getExports();return void 0===e?0:e.wasminoReadPin(t)},t.prototype.writePin=function(t,e){var n=this.getExports();if(void 0===n)throw new Error("Not initialized");n.wasminoSetUptime(Number(this.hostClock/BigInt(1e9)),Number(this.hostClock%BigInt(1e9))),n.wasminoWritePin(t,e),n.wasminoSetUptime(Number(this.clientClock/BigInt(1e9)),Number(this.clientClock%BigInt(1e9)))},t.prototype.getPinCount=function(){var t=this.getExports();if(void 0===t)throw new Error("Not initialized");return t.wasminoGetPinCount()},t.prototype.getPinMode=function(t){var e=this.getExports();if(void 0===e)throw new Error("Not initialized");return e.wasminoGetPinMode(t)},t.prototype.getExports=function(){if(void 0!==this.instance)return this.instance.exports},t.prototype._tick=function(){var t=this.getExports();if(void 0===t)throw new Error("Cannot tick before initialization");for(;this.clientClock<this.hostClock;)t.asyncify_start_rewind(this.asyncifyPtr),t._start(),t.asyncify_stop_unwind()},t}();e.default=l},27:function(t,e,n){},29:function(t,e,n){},66:function(t,e,n){"use strict";n.r(e);var i,r=n(0),a=n(2),c=n.n(a),o=n(20),s=n.n(o),l=(n(27),n(5)),u=n(11),h=n.n(u),f=n(21),p=n(3),d=n(1),b=(n(29),n(12)),v=n.n(b),y=n(13),g=n.n(y),j=new URLSearchParams(window.location.hash.replace(/^#/,"")),w=null!==(i=j.get("src"))&&void 0!==i?i:"",m={};try{var O;m=JSON.parse(null!==(O=j.get("pins"))&&void 0!==O?O:"{}")}catch(_){console.warn("Cannot parse pins config, defaulting to empty")}var x,C=new v.a("",g.a);!function(t){t.LED="led",t.SWITCH="switch"}(x||(x={}));var k=function(t){return Object(r.jsxs)("div",{className:"component",children:[Object(r.jsx)("div",{className:"led",style:{backgroundColor:"rgba(".concat(t.color,", ").concat(t.value,")")}}),Object(r.jsx)("div",{className:"pin-name",children:t.text}),Object(r.jsx)("div",{className:"close",onClick:t.onClose,children:"x"})]})},N=function(t){return Object(r.jsxs)("div",{className:"component",children:[Object(r.jsxs)("label",{className:"switch",children:[Object(r.jsx)("input",{type:"checkbox",onChange:function(e){void 0!==t.onChange&&t.onChange(e.currentTarget.checked)}}),Object(r.jsx)("span",{className:"slider round"})]}),Object(r.jsx)("div",{className:"pin-name",children:t.text}),Object(r.jsx)("div",{className:"close",onClick:t.onClose,children:"x"})]})},S=function(t){switch(t.type){case x.LED:return Object(r.jsx)(k,Object(d.a)({},t));case x.SWITCH:return Object(r.jsx)(N,Object(d.a)({},t));default:return Object(r.jsx)("div",{})}};var I=function(){var t=c.a.useState(w),e=Object(p.a)(t,2),n=e[0],i=e[1],o=c.a.useState(),s=Object(p.a)(o,2),u=s[0],b=s[1],y=c.a.useState(m),j=Object(p.a)(y,2),O=j[0],k=j[1],N=c.a.useState({}),I=Object(p.a)(N,2),P=I[0],B=I[1],E=c.a.useState(C.running),A=Object(p.a)(E,2),L=A[0],T=A[1],z=new URLSearchParams;z.set("src",n),z.set("pins",JSON.stringify(O)),window.location.hash="#"+z.toString();var W=function(){var t=Object(f.a)(h.a.mark((function t(){var e,i,r;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!C.running){t.next=2;break}return t.abrupt("return");case 2:if(e=n,t.prev=3,!n.startsWith("gist://")){t.next=12;break}return t.next=7,fetch("https://api.github.com/gists/"+n.slice(7));case 7:return i=t.sent,t.next=10,i.json();case 10:r=t.sent,e=Object.values(r.files)[0].raw_url;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),alert("Cannot fetch Gist, check Gist ID?");case 17:try{C=new v.a(e,g.a),T(!0),C.run(50)}catch(_){console.error(_),alert("Cannot initialize Wasmino, check console logs for detail")}case 18:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(){return t.apply(this,arguments)}}();return Object(a.useEffect)((function(){var t=setInterval((function(){if(C.initialized){var t={};for(var e in O){var n=C.readPin(Number(e));t[e]=n}B(t)}}),50);return function(){clearInterval(t)}})),Object(r.jsxs)("div",{className:"app",children:[Object(r.jsxs)("div",{className:"controls",children:[Object(r.jsx)("input",{placeholder:"WASM URL",value:n,onChange:function(t){i(t.currentTarget.value)}}),Object(r.jsx)("button",{onClick:L?function(){T(!1),C.stop()}:W,children:L?"Stop":"Run"}),Object(r.jsx)("input",{type:"number",placeholder:"PIN number",onChange:function(t){b(t.currentTarget.valueAsNumber>>0)}}),Object(r.jsx)("button",{onClick:function(){void 0===u||isNaN(u)||k(Object(d.a)(Object(d.a)({},O),{},Object(l.a)({},u,{type:x.LED})))},children:"Add LED"}),Object(r.jsx)("button",{onClick:function(){void 0===u||isNaN(u)||k(Object(d.a)(Object(d.a)({},O),{},Object(l.a)({},u,{type:x.SWITCH})))},children:"Add Switch"})]}),Object(r.jsx)("div",{className:"switchboard",children:Object.keys(O).map((function(t){return Object(r.jsx)(S,Object(d.a)({},function(t){var e=O[t].type,n=P[t],i="PIN ".concat(t),r=function(){var e=O;delete e[t],k(e)};switch(e){case x.LED:return Object(d.a)(Object(d.a)({color:"0, 255, 0"},O[t]),{},{type:e,text:i,onClose:r,value:n});case x.SWITCH:return Object(d.a)(Object(d.a)({},O[t]),{},{type:e,text:i,onClose:r,onChange:function(e){C.initialized&&C.writePin(Number(t),e?1:0)}})}}(t)),t)}))})]})},P=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,67)).then((function(e){var n=e.getCLS,i=e.getFID,r=e.getFCP,a=e.getLCP,c=e.getTTFB;n(t),i(t),r(t),a(t),c(t)}))};s.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(I,{})}),document.getElementById("root")),P()}},[[66,1,2]]]);
//# sourceMappingURL=main.b6ccf31c.chunk.js.map